# -*- makefile -*-

ifndef EXISTDB/
EXISTDB/    := $/../existDB/
endif

ifndef POSITIONDB/
POSITIONDB/ := $/../positionDB/
endif

ifndef MERYL/
MERYL/    := $/../meryl/
endif

ifndef LIBBRI/
LIBBRI/     := $/../libbri/
endif

ifndef FASTA/
FASTA/      := $/../fasta/
endif

ifndef SIM4/
SIM4/       := $/../sim4/
endif

ifndef SIM4POLISH/
SIM4POLISH/ := $/../sim4polish/
endif

src      := $/snapper2.C $/configuration.C $/encodedQuery.C \
            $/thr-search.C $/thr-loader.C $/thr-deadlock.C \
            $/hitMatrix.C $/hitMatrix-sort.C \
            $/hitMatrix.H $/intervalList.H $/posix.H $/snapper2.H

$/.CXX_SRCS := $(filter %.C,${src})
ifdef WITH_THREADS
 $/.CXX_EXES := $/snapper2
else
 $/.CXX_EXES :=
 $(warning $/snapper2 requires threads: enable WITH_THREADS to build it.)
endif

$/.CLEAN     :=$/*.o
$/.REAL-CLEAN:=$/buildinfo-*


$/%.d $/%.o: \
  CXXFLAGS+= -I${LIBBRI/} -I${FASTA/} -I${POSITIONDB/} \
            -I${SIM4/} -I${SIM4POLISH/} -I${EXISTDB/}
$/configuration.C.d: $/buildinfo-snapper2.h \
                     ${EXISTDB/}buildinfo-existDB.h \
                     ${POSITIONDB/}buildinfo-positionDB.h \
                     ${LIBBRI/}buildinfo-libbri.h \
                     ${FASTA/}buildinfo-libfasta.h \
                     ${SIM4/}buildinfo-libsim4.h \
                     ${SIM4POLISH/}buildinfo-libsim4polish.h

$/snapper2: \
              ${$/.CXX_SRCS:.C=.o} $/buildinfo-snapper2.o \
              ${EXISTDB/}libexistDB.a ${POSITIONDB/}libpositionDB.a \
              ${MERYL/}libmeryl.a \
              ${SIM4POLISH/}libsim4polish.a ${SIM4/}libsim4.a \
              ${FASTA/}libfasta.a ${LIBBRI/}libbri.a

$/buildinfo-snapper2.c: $/buildinfo-snapper2.h
$/buildinfo-snapper2.h: ${src}
	${UTIL/}buildinfo.pl snapper2 "${CXXFLAGS} ${CXXFLAGS_COMPILE}" $^
	mv buildinfo-snapper2.[ch] `dirname $@`




